# railway.toml
# This file tells Railway how to build and deploy your services

[build]
builder = "NIXPACKS" # This tells Railway to auto-detect the setup

[deploy]
# This command runs on startup. It will start the Spring app AND the Ollama server.
# It also pulls the llama3:8b model into Ollama before starting.
startCommand = "ollama serve & (ollama pull llama3:8b && java -jar app.jar)"
healthcheckPath = "/"
healthcheckTimeout = 240
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 3

# We need to tell Railway to install Ollama for us
[nixpacks]
pkgs = ["...pkgs.ollama"]